(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var t,n={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"6e7b862c-e036-4ad7-9192-22356f56d7f2","Content-Type":"application/json"}},r=function(e,t){return fetch(e,t).then(o)},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},c=function(e){return r("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers})},a=function(e){return r("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers})};function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",l)}function l(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&u(t)}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var d=document.querySelector(".content").querySelector(".places__list"),p=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_avatar-edit"),_=document.querySelector(".popup_type_image"),y=document.querySelector(".popup_type_confirm-delete"),v=_.querySelector(".popup__image"),b=_.querySelector(".popup__caption"),h=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__avatar-edit-button"),C=document.querySelectorAll(".popup__close"),g=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),L=document.forms["edit-profile"],x=L.elements.name,U=L.elements.description,w=document.forms["new-place"],P=w.elements["place-name"],T=w.elements.link,j=document.forms["edit-avatar"],A=j.elements["avatar-link"],I=null,O=y.querySelector(".popup__button"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function B(e){var n=function(e,t){var n=t.handleCardClick,r=t.currentUserId,o=t.openConfirmDeletePopup,i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),u=i.querySelector(".card__delete-button"),l=i.querySelector(".card__image"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count");return i.querySelector(".card__title").textContent=e.name,l.src=e.link,l.alt=e.name,d.textContent=e.likes.length,e.owner&&e.owner._id===r?(u.style.display="block",u.addEventListener("click",(function(){o(i,e._id)}))):u.style.display="none",l.addEventListener("click",(function(){n(e.name,e.link)})),e.likes.some((function(e){return e._id===r}))&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(t){var n=s.classList.contains("card__like-button_is-active");!function(e,t,n,r){var o=e.target;r?a(t).then((function(e){o.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length,r=!1})).catch((function(e){console.error("Ошибка при снятии лайка: ".concat(e))})):c(t).then((function(e){o.classList.add("card__like-button_is-active"),n.textContent=e.likes.length,r=!0})).catch((function(e){console.error("Ошибка при постановке лайка: ".concat(e))}))}(t,e._id,d,n)})),i}(e,{handleCardClick:N,currentUserId:t,openConfirmDeletePopup:V});d.prepend(n)}function N(e,t){v.src=t,v.alt=e,b.textContent=e,i(_)}function V(e,t){I={cardElement:e,cardId:t},i(y)}(0,e.enableValidation)(D),Promise.all([r("".concat(n.baseUrl,"/users/me"),{headers:n.headers}),r("".concat(n.baseUrl,"/cards"),{headers:n.headers})]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];g.textContent=c.name,q.textContent=c.about,E.style.backgroundImage="url(".concat(c.avatar,")"),t=c._id,a.reverse().forEach(B)})).catch((function(e){console.error("Ошибка при загрузке данных: ".concat(e))})),h.addEventListener("click",(function(){x.value=g.textContent,U.value=q.textContent,(0,e.clearValidation)(L,D);var t=L.querySelector(D.submitButtonSelector);(0,e.toggleButtonState)(L,t,D),i(p)})),S.addEventListener("click",(function(){w.reset(),(0,e.clearValidation)(w,D),i(f)})),k.addEventListener("click",(function(){j.reset(),(0,e.clearValidation)(j,D),i(m)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,o,c=e.submitter;c.textContent="Сохранение...",(t=x.value,o=U.value,r("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:o})})).then((function(e){g.textContent=e.name,q.textContent=e.about,u(p)})).catch((function(e){console.error("Ошибка при обновлении профиля: ".concat(e))})).finally((function(){c.textContent="Сохранить"}))})),w.addEventListener("submit",(function(e){e.preventDefault();var t,o,c=e.submitter;c.textContent="Сохранение...",(t=P.value,o=T.value,r("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:o})})).then((function(e){B(e),u(f)})).catch((function(e){console.error("Ошибка при добавлении карточки: ".concat(e))})).finally((function(){c.textContent="Сохранить"}))})),j.addEventListener("submit",(function(e){e.preventDefault();var t,o=e.submitter;o.textContent="Сохранение...",(t=A.value,r("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})})).then((function(e){E.style.backgroundImage="url(".concat(e.avatar,")"),u(m)})).catch((function(e){console.error("Ошибка при обновлении аватара: ".concat(e))})).finally((function(){o.textContent="Сохранить"}))})),C.forEach((function(e){e.addEventListener("click",(function(e){u(e.target.closest(".popup"))}))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),I&&(O.textContent="Удаление...",(t=I.cardId,r("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers})).then((function(){I.cardElement.remove(),I=null,u(y)})).catch((function(e){console.error("Ошибка при удалении карточки: ".concat(e))})).finally((function(){O.textContent="Да"})))}))})();